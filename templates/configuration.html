<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <title>Device Configuration</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Device Configuration</h1>

        <div id="hostname-section">
            <h2>Hostname</h2>
            <label for="hostname">Hostname:</label>
            <input type="text" id="hostname" name="hostname">
            <button id="save-hostname">Save</button>
        </div>

        <div id="network-section">
            <h2>Network Configuration</h2>

            <!-- Ethernet Configuration -->
            <h3>Ethernet (eth0)</h3>
            <label for="eth0-dhcp">DHCP:</label>
            <input type="checkbox" id="eth0-dhcp" name="eth0-dhcp">
            <div id="eth0-static-config" class="static-config">
                <label for="eth0-ip">IP Address:</label>
                <input type="text" id="eth0-ip" name="eth0-ip">
                <label for="eth0-subnet">Subnet Mask:</label>
                <input type="text" id="eth0-subnet" name="eth0-subnet">
                <label for="eth0-gateway">Gateway:</label>
                <input type="text" id="eth0-gateway" name="eth0-gateway">
                <label for="eth0-dns1">DNS Server 1:</label>
                <input type="text" id="eth0-dns1" name="eth0-dns1">
                <label for="eth0-dns2">DNS Server 2:</label>
                <input type="text" id="eth0-dns2" name="eth0-dns2">
            </div>
            <button id="save-eth0">Save</button>

            <!-- Wi-Fi Configuration -->
            <h3>Wi-Fi (wlan0)</h3>
            <label for="wlan0-dhcp">DHCP:</label>
            <input type="checkbox" id="wlan0-dhcp" name="wlan0-dhcp">
            <div id="wlan0-static-config" class="static-config">
                <label for="wlan0-ip">IP Address:</label>
                <input type="text" id="wlan0-ip" name="wlan0-ip">
                <label for="wlan0-subnet">Subnet Mask:</label>
                <input type="text" id="wlan0-subnet" name="wlan0-subnet">
                <label for="wlan0-gateway">Gateway:</label>
                <input type="text" id="wlan0-gateway" name="wlan0-gateway">
                <label for="wlan0-dns1">DNS Server 1:</label>
                <input type="text" id="wlan0-dns1" name="wlan0-dns1">
                <label for="wlan0-dns2">DNS Server 2:</label>
                <input type="text" id="wlan0-dns2" name="wlan0-dns2">
            </div>
            <label for="wifi-ssid">SSID:</label>
            <input type="text" id="wifi-ssid" name="wifi-ssid">
            <label for="wifi-password">Password:</label>
            <input type="password" id="wifi-password" name="wifi-password">
            <button id="save-wlan0">Save</button>
        </div>

        <div id="time-section">
            <h2>Time Configuration</h2>
            <label for="timezone">Time Zone:</label>
            <input type="text" id="timezone" name="timezone">
            <label for="daylight-savings">Daylight Savings:</label>
            <input type="checkbox" id="daylight-savings" name="daylight-savings">
            <label for="ntp-server">NTP Server:</label>
            <input type="text" id="ntp-server" name="ntp-server">
            <button id="save-time">Save</button>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Load initial config
            $.getJSON('/api/device/config', function (data) {
                if (data.status === 'success') {
                    const config = data.config;

                    // Hostname
                    $('#hostname').val(config.hostname);

                    // Ethernet (eth0) config
                    const eth0 = config.eth0;
                    if (eth0.status === "inactive") {
                        $('#eth0-dhcp').prop('checked', false);
                        $('#eth0-static-config').hide();
                    } else {
                        $('#eth0-dhcp').prop('checked', eth0.dhcp);
                        if (eth0.dhcp) {
                            $('#eth0-static-config').hide();
                        } else {
                            $('#eth0-ip').val(eth0.ip_address);
                            $('#eth0-subnet').val(eth0.subnet_mask);
                            $('#eth0-gateway').val(eth0.gateway);
                            $('#eth0-dns1').val(eth0.dns1 || '');
                            $('#eth0-dns2').val(eth0.dns2 || '');
                        }
                    }

                    // Wi-Fi (wlan0) config
                    const wlan0 = config.wlan0;
                    if (wlan0.status === "inactive") {
                        $('#wlan0-dhcp').prop('checked', false);
                        $('#wlan0-static-config').hide();
                    } else {
                        $('#wlan0-dhcp').prop('checked', wlan0.dhcp);
                        if (wlan0.dhcp) {
                            $('#wlan0-static-config').hide();
                        } else {
                            $('#wlan0-ip').val(wlan0.ip_address);
                            $('#wlan0-subnet').val(wlan0.subnet_mask);
                            $('#wlan0-gateway').val(wlan0.gateway);
                            $('#wlan0-dns1').val(wlan0.dns1 || '');
                            $('#wlan0-dns2').val(wlan0.dns2 || '');
                        }
                    }
                    $('#wifi-ssid').val(wlan0.ssid);

                    // Time configuration
                    $('#timezone').val(config.timezone);
                    $('#daylight-savings').prop('checked', config.daylight_savings);
                    $('#ntp-server').val(config.ntp_server);
                }
            });

            // Toggle visibility of static IP fields based on DHCP checkbox
            $('#eth0-dhcp').change(function () {
                $('#eth0-static-config').toggle(!$(this).is(':checked'));
            });

            $('#wlan0-dhcp').change(function () {
                $('#wlan0-static-config').toggle(!$(this).is(':checked'));
            });

            // Save button actions
            $('#save-hostname').click(function () {
                const hostname = $('#hostname').val();
                $.post('/api/device/config', { hostname }, function (data) {
                    alert(data.message);
                });
            });

            $('#save-eth0').click(function () {
                const payload = {
                    interface: 'eth0',
                    dhcp: $('#eth0-dhcp').is(':checked'),
                    ip_address: $('#eth0-ip').val(),
                    subnet_mask: $('#eth0-subnet').val(),
                    gateway: $('#eth0-gateway').val(),
                    dns1: $('#eth0-dns1').val(),
                    dns2: $('#eth0-dns2').val(),
                };
                $.post('/api/device/config', payload, function (data) {
                    alert(data.message);
                });
            });

            $('#save-wlan0').click(function () {
                const payload = {
                    interface: 'wlan0',
                    dhcp: $('#wlan0-dhcp').is(':checked'),
                    ip_address: $('#wlan0-ip').val(),
                    subnet_mask: $('#wlan0-subnet').val(),
                    gateway: $('#wlan0-gateway').val(),
                    dns1: $('#wlan0-dns1').val(),
                    dns2: $('#wlan0-dns2').val(),
                    wifi_ssid: $('#wifi-ssid').val(),
                    wifi_password: $('#wifi-password').val(),
                };
                $.post('/api/device/config', payload, function (data) {
                    alert(data.message);
                });
            });

            $('#save-time').click(function () {
                const payload = {
                    timezone: $('#timezone').val(),
                    daylight_savings: $('#daylight-savings').is(':checked'),
                    ntp_server: $('#ntp-server').val(),
                };
                $.post('/api/device/config', payload, function (data) {
                    alert(data.message);
                });
            });
        });
    </script>
</body>
</html>
