<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Configuration</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Device Configuration</h1>
    
    <!-- Hostname Configuration -->
    <section>
        <h2>Hostname</h2>
        <label for="hostname">Hostname:</label>
        <input type="text" id="hostname">
        <button id="save-hostname">Save Hostname</button>
    </section>
    
    <!-- Network Configuration -->
    <section>
        <h2>Network Configuration</h2>
        <label for="dhcp-toggle">Use DHCP:</label>
        <input type="checkbox" id="dhcp-toggle">
        <br>
        <label for="ip-address">IP Address:</label>
        <input type="text" id="ip-address" disabled>
        <br>
        <label for="subnet-mask">Subnet Mask:</label>
        <input type="text" id="subnet-mask" disabled>
        <br>
        <label for="gateway">Gateway:</label>
        <input type="text" id="gateway" disabled>
        <br>
        <label for="dns-server">DNS Server:</label>
        <input type="text" id="dns-server" disabled>
        <br>
        <button id="save-network">Save Network Settings</button>
    </section>
    
    <!-- Time Configuration -->
    <section>
        <h2>Time Configuration</h2>
        <label for="timezone">Time Zone:</label>
        <input type="text" id="timezone">
        <br>
        <label for="daylight-savings">Daylight Savings:</label>
        <input type="checkbox" id="daylight-savings">
        <br>
        <label for="ntp-server">NTP Server:</label>
        <input type="text" id="ntp-server">
        <br>
        <button id="save-time">Save Time Settings</button>
    </section>
    
    <!-- WiFi Configuration -->
    <section>
        <h2>WiFi Configuration</h2>
        <label for="wifi-ssid">WiFi SSID:</label>
        <input type="text" id="wifi-ssid">
        <br>
        <label for="wifi-password">WiFi Password:</label>
        <input type="password" id="wifi-password">
        <br>
        <button id="save-wifi">Save WiFi Settings</button>
    </section>
    
    <script>
       $(document).ready(function () {
            // Fetch initial configuration
            $.get('/api/device/config', function (data) {
                if (data.status === 'success') {
                    const config = data.config;
                    $('#hostname').val(config.hostname);
                    $('#dhcp-toggle').prop('checked', config.dhcp);
                    $('#ip-address').val(config.ip_address).prop('disabled', config.dhcp);
                    $('#subnet-mask').val(config.subnet_mask).prop('disabled', config.dhcp);
                    $('#gateway').val(config.gateway).prop('disabled', config.dhcp);
                    $('#dns-server').val(config.dns_server).prop('disabled', config.dhcp);
                    $('#timezone').val(config.timezone);
                    $('#daylight-savings').prop('checked', config.daylight_savings);
                    $('#ntp-server').val(config.ntp_server);
                    $('#wifi-ssid').val(config.wifi_ssid);
                }
            });

            // Save Hostname
            $('#save-hostname').click(function () {
                const hostname = $('#hostname').val();
                $.post('/api/device/config', JSON.stringify({ hostname }), 'json');
            });

            // Save Network Settings
            $('#save-network').click(function () {
                const dhcp = $('#dhcp-toggle').is(':checked');
                const ip_address = $('#ip-address').val();
                const subnet_mask = $('#subnet-mask').val();
                const gateway = $('#gateway').val();
                const dns_server = $('#dns-server').val();
                $.post('/api/device/config', JSON.stringify({ dhcp, ip_address, subnet_mask, gateway, dns_server }), 'json');
            });

            // Save Time Settings
            $('#save-time').click(function () {
                const timezone = $('#timezone').val();
                const daylight_savings = $('#daylight-savings').is(':checked');
                const ntp_server = $('#ntp-server').val();
                $.post('/api/device/config', JSON.stringify({ timezone, daylight_savings, ntp_server }), 'json');
            });

            // Save WiFi Settings
            $('#save-wifi').click(function () {
                const wifi_ssid = $('#wifi-ssid').val();
                const wifi_password = $('#wifi-password').val();
                $.post('/api/device/config', JSON.stringify({ wifi_ssid, wifi_password }), 'json');
            });

            // Toggle DHCP
            $('#dhcp-toggle').change(function () {
                const use_dhcp = $(this).is(':checked');
                $('#ip-address, #subnet-mask, #gateway, #dns-server').prop('disabled', use_dhcp);
            });
        });
      
    </script>
</body>
</html>
